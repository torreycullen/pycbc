

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pycbc.workflow.datafind &mdash; PyCBC 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyCBC 0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="pycbc" href="../../pycbc.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../../index.html" class="icon icon-home"> PyCBC
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing PyCBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#setting-up-a-virtual-environment-for-installing-pycbc">Setting up a virtual environment for installing PyCBC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install_virtualenv.html">Setting up virtualenv</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install_virtualenv.html#install-pip">Install pip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../install_virtualenv.html#install-virtualenv">Install virtualenv</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing-lalsuite-into-a-virtual-environment">Installing lalsuite into a virtual environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install_lalsuite.html">Installing lalsuite for PyCBC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install_lalsuite.html#obtaining-the-source-code-and-checking-out-a-version">Obtaining the source code and checking out a version</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../install_lalsuite.html#building-and-installing-into-your-virtual-environment">Building and installing into your virtual environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing-pycbc-in-a-virtual-environment">Installing PyCBC in a virtual environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install.html#installing-a-released-version-of-pycbc">Installing a released version of PyCBC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install.html#installing-source-from-github-for-development">Installing source from GitHub for development</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#building-and-installing-documentation">Building and Installing Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../build_gh_pages.html">Building Documentation for Git Hub Pages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../build_gh_pages.html#creating-a-git-hub-project-page">Creating a Git Hub project page</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../build_gh_pages.html#building-and-pushing-the-documentation">Building and pushing the documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#modifying-pycbc-glue-and-pycbc-pylal">Modifying pycbc-glue and pycbc-pylal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#use-of-intel-mkl-optimized-fft-libraries">Use of Intel MKL Optimized FFT libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#graphics-processing-unit-support-with-cuda">Graphics Processing Unit support with CUDA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install_cuda.html">Instructions to add CUDA support (optional)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install_cuda.html#installing-the-cuda-dependencies">Installing the CUDA dependencies</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow.html">Workflow: the inspiral analysis workflow generator (<code class="docutils literal"><span class="pre">pycbc.workflow</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#workflow-to-do-list">Workflow to do list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pycbc-make-coinc-workflow"><code class="docutils literal"><span class="pre">pycbc_make_coinc_workflow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/pycbc_make_coinc_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_coinc_workflow</span></code>: A CBC analysis workflow generator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pycbc-make-sngl-workflow"><code class="docutils literal"><span class="pre">pycbc_make_sngl_workflow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/pycbc_make_sngl_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_sngl_workflow</span></code>: A single-ifo detchar tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pycbc-make-daily-workflow"><code class="docutils literal"><span class="pre">pycbc_make_daily_workflow</span></code></a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#data-checker"><cite>data_checker</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pygrb"><code class="docutils literal"><span class="pre">pygrb</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/pygrb.html">PyGRB: A GRB triggered CBC analysis workflow generator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#workflow-module-documentation">Workflow module documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#initialization">Initialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/initialization.html">Pycbc&#8217;s workflow module configuration file(s) and command line interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#generating-segments">Generating segments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/segments.html">The workflow segment generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#obtaining-data">Obtaining data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/datafind.html">The workflow datafind and validation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#injection-generation">Injection generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/injections.html">The workflow injection generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#time-slide-generation">Time-slide generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/time_slides.html">The workflow time-slide generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#template-bank">Template bank</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/template_bank.html">The workflow template bank generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#split-table">Split table</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/splittable.html">The workflow table splitting module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#matched-filtering">Matched-filtering</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/matched_filter.html">The workflow matched-filter module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#coincidence">Coincidence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/coincidence.html">The workflow coincidence module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#post-processing-preparation">Post processing preparation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/postprocprep.html">The workflow postprocessing preparation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#post-processing">Post-processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/postproc.html">The workflow postprocessing module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#method-documentation">Method documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.workflow.html">pycbc.workflow package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.analysislogging">pycbc.workflow.analysislogging module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.coincidence">pycbc.workflow.coincidence module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.configparser_test">pycbc.workflow.configparser_test module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.configuration">pycbc.workflow.configuration module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.core">pycbc.workflow.core module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.datafind">pycbc.workflow.datafind module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.injection">pycbc.workflow.injection module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.jobsetup">pycbc.workflow.jobsetup module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.legacy_ihope">pycbc.workflow.legacy_ihope module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.matched_filter">pycbc.workflow.matched_filter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.pegasus_workflow">pycbc.workflow.pegasus_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.plotting">pycbc.workflow.plotting module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.postprocessing">pycbc.workflow.postprocessing module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.postprocessing_prep">pycbc.workflow.postprocessing_prep module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.segment">pycbc.workflow.segment module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.splittable">pycbc.workflow.splittable module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.summaryplots">pycbc.workflow.summaryplots module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.timeslides">pycbc.workflow.timeslides module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.tmpltbank">pycbc.workflow.tmpltbank module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tmpltbank.html">PyCBC template bank generation documentation (<code class="docutils literal"><span class="pre">pycbc.tmpltbank</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#non-spin-bank-placement-pycbc-geom-nonspinbank">Non spin bank placement: pycbc_geom_nonspinbank</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#some-examples">Some examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options">Command line options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#aligned-spin-geometric-placement-pycbc-geom-aligned-bank">Aligned-spin geometric placement: pycbc_geom_aligned_bank</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id1">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id2">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id3">Some examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id4">Command line options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#aligned-spin-stochastic-placement">Aligned-spin stochastic placement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id5">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id6">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#ian-s-recommendation-which-stochastic-code-should-i-use">Ian&#8217;s recommendation: Which stochastic code should I use?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tmpltbank.html#i-want-to-use-the-f2-or-r2f4-metric">I want to use the F2 or R2F4 metric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tmpltbank.html#i-want-to-use-another-metric-ie-an-imr-metric">I want to use another metric, ie. an IMR metric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tmpltbank.html#i-want-to-use-direct-match">I want to use direct match</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id7">Some examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options-pycbc-aligned-stoch-bank">Command line options: pycbc_aligned_stoch_bank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options-lalapps-cbc-sbank">Command line options: lalapps_cbc_sbank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options-lalapps-cbc-sbank-pipe">Command line options: lalapps_cbc_sbank_pipe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#hybrid-approaches-the-best-of-both-worlds">Hybrid approaches: the best of both worlds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#the-module-s-source-code">The module&#8217;s source code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.tmpltbank.html">pycbc.tmpltbank package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.bank_output_utils">pycbc.tmpltbank.bank_output_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.brute_force_methods">pycbc.tmpltbank.brute_force_methods module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.calc_moments">pycbc.tmpltbank.calc_moments module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.coord_utils">pycbc.tmpltbank.coord_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.em_progenitors">pycbc.tmpltbank.em_progenitors module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.lambda_mapping">pycbc.tmpltbank.lambda_mapping module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.lattice_utils">pycbc.tmpltbank.lattice_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.option_utils">pycbc.tmpltbank.option_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.partitioned_bank">pycbc.tmpltbank.partitioned_bank module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.psd.html">pycbc.psd package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd.analytical">pycbc.psd.analytical module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd.estimate">pycbc.psd.estimate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd.read">pycbc.psd.read module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.noise.html">pycbc.noise package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.noise.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.noise.html#module-pycbc.noise.gaussian">pycbc.noise.gaussian module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.noise.html#module-pycbc.noise">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../frame.html">Reading Gravitational-wave Frames (<code class="docutils literal"><span class="pre">pycbc.frame</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../frame.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frame.html#module-pycbc.frame">Method documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../banksim.html">Dag Generator for Doing Banksims</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../banksim.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../banksim.html#how-to-generate-a-workflow-to-do-a-large-banksim">How to generate a workflow to do a large banksim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#creating-an-ini-file">Creating an INI file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#generating-the-workflow">Generating the workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#understanding-the-results">Understanding the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#workflow-considerations">Workflow considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#example-config-files">Example config files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faithsim.html">Dag Generator for Doing Faithfulness Comparisons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../faithsim.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faithsim.html#how-to-generate-a-workflow">How to generate a workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#creating-a-configuration-ini-file">Creating a configuration (.ini) file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#generating-the-workflow">Generating the workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#understanding-the-results">Understanding the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#example-config-files">Example config files</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pycbc_bns_hdf_config_walkthrough.html">Walkthrough of running the PyCBC BNS focused pipeline on SUGAR</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow/pycbc_bns_hdf_config_walkthrough.html#run-sh">run.sh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow/pycbc_bns_hdf_config_walkthrough.html#config-file">config file</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../waveform.html">Waveforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#what-waveforms-can-i-generate">What waveforms can I generate?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-time-domain-waveforms">Plotting Time Domain Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#calculating-the-match-between-waveforms">Calculating the match between waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-a-td-and-fd-waveform-together-in-the-td">Plotting a TD and FD waveform together in the TD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-gw-phase-and-amplitude-of-td-waveform">Plotting GW phase and amplitude of TD waveform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-frequency-evolution-of-td-waveform">Plotting frequency evolution of TD waveform</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">Documenting PyCBC code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#sphinx">Sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#documenting-the-pycbc-package">Documenting the PyCBC package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#documenting-pycbc-modules">Documenting PyCBC modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#documenting-pycbc-scripts">Documenting PyCBC scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Creating Releases of PyCBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../release.html#creating-the-release-on-github">Creating the release on GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../release.html#uploading-to-the-python-package-index">Uploading to the Python Package Index</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../formats/hdf_format.html">HDF files within the PyCBC workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../formats/hdf_format.html#single-inspiral-triggers">single inspiral triggers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#executables">Executables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#specification">Specification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../formats/hdf_format.html#combined-single-inspiral-triggers">combined single inspiral triggers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#id1">Executables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#id2">Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#example-uses">Example uses</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">PyCBC</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../pycbc.html">pycbc</a> &raquo;</li>
      
    <li>pycbc.workflow.datafind</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pycbc.workflow.datafind</h1><div class="highlight"><pre>
<span class="c"># Copyright (C) 2013  Ian Harry</span>
<span class="c">#</span>
<span class="c"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c"># under the terms of the GNU General Public License as published by the</span>
<span class="c"># Free Software Foundation; either version 3 of the License, or (at your</span>
<span class="c"># option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful, but</span>
<span class="c"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="c"># Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License along</span>
<span class="c"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c"># 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>

<span class="c">#</span>
<span class="c"># =============================================================================</span>
<span class="c">#</span>
<span class="c">#                                   Preamble</span>
<span class="c">#</span>
<span class="c"># =============================================================================</span>
<span class="c">#</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module is responsible for querying a datafind server to determine the</span>
<span class="sd">availability of the data that the code is attempting to run on. It also</span>
<span class="sd">performs a number of tests and can act on these as described below. Full</span>
<span class="sd">documentation for this function can be found here:</span>
<span class="sd">https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/datafind.html</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">urlparse</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">glue</span> <span class="kn">import</span> <span class="n">segments</span><span class="p">,</span> <span class="n">lal</span>
<span class="kn">from</span> <span class="nn">glue.ligolw</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">lsctables</span><span class="p">,</span> <span class="n">ligolw</span>
<span class="kn">from</span> <span class="nn">pycbc.workflow.core</span> <span class="kn">import</span> <span class="n">OutSegFile</span><span class="p">,</span> <span class="n">File</span><span class="p">,</span> <span class="n">FileList</span><span class="p">,</span> <span class="n">make_analysis_dir</span>
<span class="kn">from</span> <span class="nn">pycbc.frame</span> <span class="kn">import</span> <span class="n">datafind_connection</span>

<div class="viewcode-block" id="ContentHandler"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.ContentHandler">[docs]</a><span class="k">class</span> <span class="nc">ContentHandler</span><span class="p">(</span><span class="n">ligolw</span><span class="o">.</span><span class="n">LIGOLWContentHandler</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<span class="n">lsctables</span><span class="o">.</span><span class="n">use_in</span><span class="p">(</span><span class="n">ContentHandler</span><span class="p">)</span>

<div class="viewcode-block" id="setup_datafind_workflow"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_workflow">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>  <span class="n">outputDir</span><span class="p">,</span> <span class="n">segFilesList</span><span class="p">,</span>
                            <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup datafind section of the workflow. This section is responsible for</span>
<span class="sd">    generating, or setting up the workflow to generate, a list of files that</span>
<span class="sd">    record the location of the frame files needed to perform the analysis.</span>
<span class="sd">    There could be multiple options here, the datafind jobs could be done at</span>
<span class="sd">    run time or could be put into a dag. The subsequent jobs will know</span>
<span class="sd">    what was done here from the OutFileList containing the datafind jobs</span>
<span class="sd">    (and the Dagman nodes if appropriate.</span>
<span class="sd">    For now the only implemented option is to generate the datafind files at</span>
<span class="sd">    runtime. This module can also check if the frameFiles actually exist, check</span>
<span class="sd">    whether the obtained segments line up with the original ones and update the</span>
<span class="sd">    science segments to reflect missing data files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    workflow: pycbc.workflow.core.Workflow</span>
<span class="sd">        The workflow class that stores the jobs that will be run.</span>
<span class="sd">    scienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        This contains the times that the workflow is expected to analyse.</span>
<span class="sd">    outputDir : path</span>
<span class="sd">        All output files written by datafind processes will be written to this</span>
<span class="sd">        directory.</span>
<span class="sd">    segFilesList : List of the files returned by segment_utils</span>
<span class="sd">        This contains representations of the various segment files that were</span>
<span class="sd">        constructed at the segment generation stage of the workflow. This will</span>
<span class="sd">        be used for the segment_summary test, or if any of the other tests are</span>
<span class="sd">        given &quot;update_times&quot; (and can be given a value of None otherwise).</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]). </span>
<span class="sd">        This is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>
<span class="sd">        FIXME: Filenames may not be unique with current codes!</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafindOuts : OutGroupList</span>
<span class="sd">        List of all the datafind output files for use later in the pipeline.</span>
<span class="sd">    scienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        This contains the times that the workflow is expected to analyse. If </span>
<span class="sd">        the updateSegmentTimes kwarg is given this will be updated to reflect </span>
<span class="sd">        any instances of missing data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Entering datafind module&quot;</span><span class="p">)</span>
    <span class="n">make_analysis_dir</span><span class="p">(</span><span class="n">outputDir</span><span class="p">)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">cp</span>

    <span class="c"># Parse for options in ini file</span>
    <span class="n">datafindMethod</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;datafind-method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_option_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                          <span class="s">&quot;datafind-check-segment-gaps&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">]):</span>
        <span class="n">checkSegmentGaps</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span> 
                                          <span class="s">&quot;datafind-check-segment-gaps&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">checkSegmentGaps</span> <span class="o">=</span> <span class="s">&quot;no_test&quot;</span>
    <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_option_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                          <span class="s">&quot;datafind-check-frames-exist&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">]):</span>
        <span class="n">checkFramesExist</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                          <span class="s">&quot;datafind-check-frames-exist&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">checkFramesExist</span> <span class="o">=</span> <span class="s">&quot;no_test&quot;</span>
    <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_option_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                          <span class="s">&quot;datafind-check-segment-summary&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">]):</span>
        <span class="n">checkSegmentSummary</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;datafind-check-segment-summary&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">checkSegmentSummary</span> <span class="o">=</span> <span class="s">&quot;no_test&quot;</span>
    
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Starting datafind with setup_datafind_runtime_generated&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;AT_RUNTIME_MULTIPLE_CACHES&quot;</span><span class="p">:</span>
        <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span> <span class="o">=</span> \
            <span class="n">setup_datafind_runtime_cache_multi_calls_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                                            <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;AT_RUNTIME_SINGLE_CACHES&quot;</span><span class="p">:</span>
        <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span> <span class="o">=</span> \
            <span class="n">setup_datafind_runtime_cache_single_call_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span> 
                                                            <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;AT_RUNTIME_MULTIPLE_FRAMES&quot;</span><span class="p">:</span>
        <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span> <span class="o">=</span> \
            <span class="n">setup_datafind_runtime_frames_multi_calls_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                                            <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;AT_RUNTIME_SINGLE_FRAMES&quot;</span><span class="p">:</span>
        <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span> <span class="o">=</span> \
            <span class="n">setup_datafind_runtime_frames_single_call_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                                            <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

    <span class="n">using_backup_server</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;AT_RUNTIME_MULTIPLE_FRAMES&quot;</span> <span class="ow">or</span> \
                                  <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;AT_RUNTIME_SINGLE_FRAMES&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_option_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                          <span class="s">&quot;datafind-backup-datafind-server&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">]):</span>
            <span class="n">using_backup_server</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">backup_server</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                      <span class="s">&quot;datafind-backup-datafind-server&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
            <span class="n">cp_new</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
            <span class="n">cp_new</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                <span class="s">&quot;datafind-ligo-datafind-server&quot;</span><span class="p">,</span> <span class="n">backup_server</span><span class="p">)</span>
            <span class="n">cp_new</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;datafind&#39;</span><span class="p">,</span> <span class="s">&#39;urltype&#39;</span><span class="p">,</span> <span class="s">&#39;gsiftp&#39;</span><span class="p">)</span>
            <span class="n">backup_datafindcaches</span><span class="p">,</span> <span class="n">backup_datafindouts</span> <span class="o">=</span>\
                <span class="n">setup_datafind_runtime_frames_single_call_perifo</span><span class="p">(</span><span class="n">cp_new</span><span class="p">,</span>
                                               <span class="n">scienceSegs</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">backup_datafindouts</span> <span class="o">=</span> <span class="n">datafind_keep_unique_backups</span><span class="p">(</span>\
                                             <span class="n">backup_datafindouts</span><span class="p">,</span> <span class="n">datafindouts</span><span class="p">)</span>
            <span class="n">datafindcaches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">backup_datafindcaches</span><span class="p">)</span>
            <span class="n">datafindouts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">backup_datafindouts</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">datafindMethod</span> <span class="o">==</span> <span class="s">&quot;FROM_PREGENERATED_LCF_FILES&quot;</span><span class="p">:</span>
        <span class="n">ifos</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span> <span class="o">=</span> \
            <span class="n">setup_datafind_from_pregenerated_lcf_files</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">ifos</span><span class="p">,</span>
                                                       <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Entry datafind-method in [workflow-datafind] does not have &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;expected value. Valid values are &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;AT_RUNTIME_MULTIPLE_FRAMES, AT_RUNTIME_SINGLE_FRAMES &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;AT_RUNTIME_MULTIPLE_CACHES or AT_RUNTIME_SINGLE_CACHES. &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;Consult the documentation for more info.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;setup_datafind_runtime_generated completed&quot;</span><span class="p">)</span>
    <span class="c"># If we don&#39;t have frame files covering all times we can update the science</span>
    <span class="c"># segments.</span>
    <span class="k">if</span> <span class="n">checkSegmentGaps</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;warn&#39;</span><span class="p">,</span><span class="s">&#39;update_times&#39;</span><span class="p">,</span><span class="s">&#39;raise_error&#39;</span><span class="p">]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Checking science segments against datafind output....&quot;</span><span class="p">)</span>
        <span class="n">newScienceSegs</span> <span class="o">=</span> <span class="n">get_science_segs_from_datafind_outs</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Datafind segments calculated.....&quot;</span><span class="p">)</span>
        <span class="n">missingData</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Any errors directly following this message refer to times that&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot; the segment server says are science, but datafind cannot find&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;frames for:&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c"># If no data in the input then do nothing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;No input science segments for ifo </span><span class="si">%s</span><span class="s"> &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;so, surprisingly, no data has been found. &quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;Was this expected?&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newScienceSegs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">ifo</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;IFO </span><span class="si">%s</span><span class="s">&#39;s science segments &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;are completely missing.&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">missingData</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">checkSegmentGaps</span> <span class="o">==</span> <span class="s">&#39;update_times&#39;</span><span class="p">:</span>
                    <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">-</span> <span class="n">newScienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;From ifo </span><span class="si">%s</span><span class="s"> we are missing frames covering:&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">missing</span><span class="p">))</span>
                <span class="n">missingData</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">checkSegmentGaps</span> <span class="o">==</span> <span class="s">&#39;update_times&#39;</span><span class="p">:</span>
                    <span class="c"># Remove missing time, so that we can carry on if desired</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Updating science times for ifo </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>
                    <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">-</span> <span class="n">missing</span>

        <span class="k">if</span> <span class="n">checkSegmentGaps</span> <span class="o">==</span> <span class="s">&#39;raise_error&#39;</span> <span class="ow">and</span> <span class="n">missingData</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Workflow cannot find needed data, exiting.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Done checking, any discrepancies are reported above.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">checkSegmentGaps</span> <span class="o">==</span> <span class="s">&#39;no_test&#39;</span><span class="p">:</span>
        <span class="c"># Do nothing</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errMsg</span> <span class="o">=</span> <span class="s">&quot;checkSegmentGaps kwArg must take a value from &#39;no_test&#39;, &quot;</span>
        <span class="n">errMsg</span> <span class="o">+=</span> <span class="s">&quot;&#39;warn&#39;, &#39;update_times&#39; or &#39;raise_error&#39;.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>

    <span class="c"># Do all of the frame files that were returned actually exist?</span>
    <span class="k">if</span> <span class="n">checkFramesExist</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;warn&#39;</span><span class="p">,</span><span class="s">&#39;update_times&#39;</span><span class="p">,</span><span class="s">&#39;raise_error&#39;</span><span class="p">]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Verifying that all frames exist on disk.&quot;</span><span class="p">)</span>
        <span class="n">missingFrSegs</span><span class="p">,</span> <span class="n">missingFrames</span> <span class="o">=</span> \
                          <span class="n">get_missing_segs_from_frame_file_cache</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">)</span>
        <span class="n">missingFlag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">missingFrames</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c"># If no data in the input then do nothing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="c"># If using a backup server, does the frame exist remotely?</span>
            <span class="k">if</span> <span class="n">using_backup_server</span><span class="p">:</span>
                <span class="c"># WARNING: This will be slow, but hopefully it will not occur</span>
                <span class="c">#          for too many frames. This could be optimized if</span>
                <span class="c">#          it becomes necessary.</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">missingFrames</span><span class="p">[</span><span class="n">ifo</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">dfout</span> <span class="ow">in</span> <span class="n">datafindouts</span><span class="p">:</span>
                        <span class="n">dfout_pfns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfout</span><span class="o">.</span><span class="n">pfns</span><span class="p">)</span>
                        <span class="n">dfout_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">url</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dfout_pfns</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">url</span> <span class="ow">in</span> <span class="n">dfout_urls</span><span class="p">:</span>
                            <span class="n">pfn</span> <span class="o">=</span> <span class="n">dfout_pfns</span><span class="p">[</span><span class="n">dfout_urls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="p">)]</span>
                            <span class="n">dfout</span><span class="o">.</span><span class="n">removePFN</span><span class="p">(</span><span class="n">pfn</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfout</span><span class="o">.</span><span class="n">pfns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Frame </span><span class="si">%s</span><span class="s"> not found locally. &quot;</span>\
                                                                  <span class="o">%</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="p">,)</span>
                                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;Replacing with remote url(s) &quot;</span>
                                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.&quot;</span> \
                                           <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">url</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dfout</span><span class="o">.</span><span class="n">pfns</span><span class="p">]),)</span>
                                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
                <span class="n">missingFrames</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_list</span>
            <span class="k">if</span> <span class="n">missingFrames</span><span class="p">[</span><span class="n">ifo</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;From ifo </span><span class="si">%s</span><span class="s"> we are missing the following frames:&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">url</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">missingFrames</span><span class="p">[</span><span class="n">ifo</span><span class="p">]])</span>
                <span class="n">missingFlag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">checkFramesExist</span> <span class="o">==</span> <span class="s">&#39;update_times&#39;</span><span class="p">:</span>
                <span class="c"># Remove missing times, so that we can carry on if desired</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Updating science times for ifo </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">))</span>
                <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">-</span> <span class="n">missingFrSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span>
                
        <span class="k">if</span> <span class="n">checkFramesExist</span> <span class="o">==</span> <span class="s">&#39;raise_error&#39;</span> <span class="ow">and</span> <span class="n">missingFlag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Workflow cannot find all frames, exiting.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Finished checking frames.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">checkFramesExist</span> <span class="o">==</span> <span class="s">&#39;no_test&#39;</span><span class="p">:</span>
        <span class="c"># Do nothing</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errMsg</span> <span class="o">=</span> <span class="s">&quot;checkFramesExist kwArg must take a value from &#39;no_test&#39;, &quot;</span>
        <span class="n">errMsg</span> <span class="o">+=</span> <span class="s">&quot;&#39;warn&#39;, &#39;update_times&#39; or &#39;raise_error&#39;.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>

    <span class="c"># Check if there are cases where frames exist, but no entry in the segment</span>
    <span class="c"># summary table are present.</span>
    <span class="k">if</span> <span class="n">checkSegmentSummary</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;warn&#39;</span><span class="p">,</span> <span class="s">&#39;raise_error&#39;</span><span class="p">]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Checking the segment summary table against frames.&quot;</span><span class="p">)</span>
        <span class="n">dfScienceSegs</span> <span class="o">=</span> <span class="n">get_science_segs_from_datafind_outs</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">)</span>
        <span class="n">missingFlag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">dfScienceSegs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">scienceFile</span> <span class="o">=</span> <span class="n">segFilesList</span><span class="o">.</span><span class="n">find_output_with_ifo</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
            <span class="n">scienceFile</span> <span class="o">=</span> <span class="n">scienceFile</span><span class="o">.</span><span class="n">find_output_with_tag</span><span class="p">(</span><span class="s">&#39;SCIENCE&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">scienceFile</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errMsg</span> <span class="o">=</span> <span class="s">&quot;Did not find exactly 1 science file.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>
            <span class="n">scienceFile</span> <span class="o">=</span> <span class="n">scienceFile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">scienceChannel</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;workflow-segments&#39;</span><span class="p">,</span>\
                                <span class="s">&#39;segments-</span><span class="si">%s</span><span class="s">-science-name&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
            <span class="n">segSummaryTimes</span> <span class="o">=</span> <span class="n">get_segment_summary_times</span><span class="p">(</span><span class="n">scienceFile</span><span class="p">,</span>
                                                        <span class="n">scienceChannel</span><span class="p">)</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="n">dfScienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">-</span> <span class="n">segSummaryTimes</span>
            <span class="n">scienceButNotFrame</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">-</span> <span class="n">dfScienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span>
            <span class="n">missing2</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">-</span> <span class="n">scienceButNotFrame</span>
            <span class="n">missing2</span> <span class="o">=</span> <span class="n">missing2</span> <span class="o">-</span> <span class="n">segSummaryTimes</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;From ifo </span><span class="si">%s</span><span class="s"> the following times have frames, &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;but are not covered in the segment summary table.&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">missing</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">missingFlag</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">missing2</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;From ifo </span><span class="si">%s</span><span class="s"> the following times have frames, &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;are science, and are not covered in the segment &quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;summary table.&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">missing2</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">missingFlag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">checkSegmentSummary</span> <span class="o">==</span> <span class="s">&#39;raise_error&#39;</span> <span class="ow">and</span> <span class="n">missingFlag</span><span class="p">:</span>
            <span class="n">errMsg</span> <span class="o">=</span> <span class="s">&quot;Segment_summary discrepancy detected, exiting.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">checkSegmentSummary</span> <span class="o">==</span> <span class="s">&#39;no_test&#39;</span><span class="p">:</span>
        <span class="c"># Do nothing</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errMsg</span> <span class="o">=</span> <span class="s">&quot;checkSegmentSummary kwArg must take a value from &#39;no_test&#39;, &quot;</span>
        <span class="n">errMsg</span> <span class="o">+=</span> <span class="s">&quot;&#39;warn&#39;, or &#39;raise_error&#39;.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>

    <span class="c"># Now need to create the file for SCIENCE_AVAILABLE</span>
    <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">availableSegsFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span> 
                           <span class="s">&quot;</span><span class="si">%s</span><span class="s">-SCIENCE_AVAILABLE_SEGMENTS.xml&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="p">))</span>
        <span class="n">currUrl</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">([</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">availableSegsFile</span><span class="p">,</span>
                          <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">currTags</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;SCIENCE_AVAILABLE&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">currTags</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SCIENCE_AVAILABLE&#39;</span><span class="p">]</span>
        <span class="n">currFile</span> <span class="o">=</span> <span class="n">OutSegFile</span><span class="p">(</span><span class="n">ifo</span><span class="p">,</span> <span class="s">&#39;SEGMENTS&#39;</span><span class="p">,</span> <span class="n">workflow</span><span class="o">.</span><span class="n">analysis_time</span><span class="p">,</span>
                            <span class="n">currUrl</span><span class="p">,</span> <span class="n">segment_list</span><span class="o">=</span><span class="n">scienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">],</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">currTags</span><span class="p">)</span>
        <span class="n">currFile</span><span class="o">.</span><span class="n">PFN</span><span class="p">(</span><span class="n">availableSegsFile</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">)</span>
        <span class="n">segFilesList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currFile</span><span class="p">)</span>
        <span class="n">currFile</span><span class="o">.</span><span class="n">toSegmentXml</span><span class="p">()</span>
   

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Leaving datafind module&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FileList</span><span class="p">(</span><span class="n">datafindouts</span><span class="p">),</span> <span class="n">scienceSegs</span>
    
</div>
<div class="viewcode-block" id="setup_datafind_runtime_cache_multi_calls_perifo"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_runtime_cache_multi_calls_perifo">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_runtime_cache_multi_calls_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span> 
                                                    <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function uses the glue.datafind library to obtain the location of all</span>
<span class="sd">    the frame files that will be needed to cover the analysis of the data</span>
<span class="sd">    given in scienceSegs. This function will not check if the returned frames</span>
<span class="sd">    cover the whole time requested, such sanity checks are done in the</span>
<span class="sd">    pycbc.workflow.setup_datafind_workflow entry function. As opposed to</span>
<span class="sd">    setup_datafind_runtime_single_call_perifo this call will one call to the</span>
<span class="sd">    datafind server for every science segment. This function will return a list</span>
<span class="sd">    of output files that correspond to the cache .lcf files that are produced,</span>
<span class="sd">    which list the locations of all frame files. This will cause problems with</span>
<span class="sd">    pegasus, which expects to know about all input files (ie. the frame files</span>
<span class="sd">    themselves.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    cp : ConfigParser.ConfigParser instance</span>
<span class="sd">        This contains a representation of the information stored within the</span>
<span class="sd">        workflow configuration files</span>
<span class="sd">    scienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        This contains the times that the workflow is expected to analyse.</span>
<span class="sd">    outputDir : path</span>
<span class="sd">        All output files written by datafind processes will be written to this</span>
<span class="sd">        directory.</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]). This</span>
<span class="sd">        is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>
<span class="sd">        FIXME: Filenames may not be unique with current codes!</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafindcaches : list of glue.lal.Cache instances</span>
<span class="sd">       The glue.lal.Cache representations of the various calls to the datafind</span>
<span class="sd">       server and the returned frame files.</span>
<span class="sd">    datafindOuts : pycbc.workflow.core.FileList</span>
<span class="sd">        List of all the datafind output files for use later in the pipeline.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># First job is to do setup for the datafind jobs</span>
    <span class="c"># First get the server name</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Setting up connection to datafind server.&quot;</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">setup_datafind_server_connection</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

    <span class="c"># Now ready to loop over the input segments</span>
    <span class="n">datafindouts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">datafindcaches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ifos</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Querying datafind server for all science segments.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">scienceSegsIfo</span> <span class="ow">in</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">observatory</span> <span class="o">=</span> <span class="n">ifo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">frameType</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span> 
                                    <span class="s">&quot;datafind-</span><span class="si">%s</span><span class="s">-frame-type&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">scienceSegsIfo</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Finding data between </span><span class="si">%d</span><span class="s"> and </span><span class="si">%d</span><span class="s"> &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;for ifo </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c"># WARNING: For now the workflow will expect times to be in integer seconds</span>
            <span class="n">startTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">endTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c"># Sometimes the connection can drop, so try a backup here</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cache</span><span class="p">,</span> <span class="n">cache_file</span> <span class="o">=</span> <span class="n">run_datafind_instance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span>
                                           <span class="n">connection</span><span class="p">,</span> <span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span>
                                           <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">connection</span> <span class="o">=</span> <span class="n">setup_datafind_server_connection</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">cache</span><span class="p">,</span> <span class="n">cache_file</span> <span class="o">=</span> <span class="n">run_datafind_instance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span>
                                           <span class="n">connection</span><span class="p">,</span> <span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span>
                                           <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">datafindouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache_file</span><span class="p">)</span>
            <span class="n">datafindcaches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span>
</div>
<div class="viewcode-block" id="setup_datafind_runtime_cache_single_call_perifo"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_runtime_cache_single_call_perifo">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_runtime_cache_single_call_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span>
                                              <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function uses the glue.datafind library to obtain the location of all</span>
<span class="sd">    the frame files that will be needed to cover the analysis of the data</span>
<span class="sd">    given in scienceSegs. This function will not check if the returned frames</span>
<span class="sd">    cover the whole time requested, such sanity checks are done in the</span>
<span class="sd">    pycbc.workflow.setup_datafind_workflow entry function. As opposed to </span>
<span class="sd">    setup_datafind_runtime_generated this call will only run one call to</span>
<span class="sd">    datafind per ifo, spanning the whole time. This function will return a list</span>
<span class="sd">    of output files that correspond to the cache .lcf files that are produced,</span>
<span class="sd">    which list the locations of all frame files. This will cause problems with</span>
<span class="sd">    pegasus, which expects to know about all input files (ie. the frame files</span>
<span class="sd">    themselves.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    cp : ConfigParser.ConfigParser instance</span>
<span class="sd">        This contains a representation of the information stored within the</span>
<span class="sd">        workflow configuration files</span>
<span class="sd">    scienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        This contains the times that the workflow is expected to analyse.</span>
<span class="sd">    outputDir : path</span>
<span class="sd">        All output files written by datafind processes will be written to this</span>
<span class="sd">        directory.</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]). This</span>
<span class="sd">        is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>
<span class="sd">        FIXME: Filenames may not be unique with current codes!</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafindcaches : list of glue.lal.Cache instances</span>
<span class="sd">       The glue.lal.Cache representations of the various calls to the datafind</span>
<span class="sd">       server and the returned frame files.</span>
<span class="sd">    datafindOuts : pycbc.workflow.core.FileList</span>
<span class="sd">        List of all the datafind output files for use later in the pipeline.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># First job is to do setup for the datafind jobs</span>
    <span class="c"># First get the server name</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Setting up connection to datafind server.&quot;</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">setup_datafind_server_connection</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

    <span class="c"># We want to ignore gaps as the detectors go up and down and calling this</span>
    <span class="c"># way will give gaps. See the setup_datafind_runtime_generated function</span>
    <span class="c"># for datafind calls that only query for data that will exist</span>
    <span class="n">cp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;datafind&quot;</span><span class="p">,</span><span class="s">&quot;on_gaps&quot;</span><span class="p">,</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="c"># Now ready to loop over the input segments</span>
    <span class="n">datafindouts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">datafindcaches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ifos</span> <span class="o">=</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Querying datafind server for all science segments.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">scienceSegsIfo</span> <span class="ow">in</span> <span class="n">scienceSegs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">observatory</span> <span class="o">=</span> <span class="n">ifo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">frameType</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;datafind-</span><span class="si">%s</span><span class="s">-frame-type&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
        <span class="c"># This REQUIRES a coalesced segment list to work</span>
        <span class="n">startTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scienceSegsIfo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">endTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scienceSegsIfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">,</span> <span class="n">cache_file</span> <span class="o">=</span> <span class="n">run_datafind_instance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                                       <span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span>
                                       <span class="n">endTime</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">setup_datafind_server_connection</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">cache</span><span class="p">,</span> <span class="n">cache_file</span> <span class="o">=</span> <span class="n">run_datafind_instance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                                       <span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span>
                                       <span class="n">endTime</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

        <span class="n">datafindouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache_file</span><span class="p">)</span>
        <span class="n">datafindcaches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span>
</div>
<div class="viewcode-block" id="setup_datafind_runtime_frames_single_call_perifo"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_runtime_frames_single_call_perifo">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_runtime_frames_single_call_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                              <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function uses the glue.datafind library to obtain the location of all</span>
<span class="sd">    the frame files that will be needed to cover the analysis of the data</span>
<span class="sd">    given in scienceSegs. This function will not check if the returned frames</span>
<span class="sd">    cover the whole time requested, such sanity checks are done in the</span>
<span class="sd">    pycbc.workflow.setup_datafind_workflow entry function. As opposed to </span>
<span class="sd">    setup_datafind_runtime_generated this call will only run one call to</span>
<span class="sd">    datafind per ifo, spanning the whole time. This function will return a list</span>
<span class="sd">    of files corresponding to the individual frames returned by the datafind</span>
<span class="sd">    query. This will allow pegasus to more easily identify all the files used</span>
<span class="sd">    as input, but may cause problems for codes that need to take frame cache</span>
<span class="sd">    files as input.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    cp : ConfigParser.ConfigParser instance</span>
<span class="sd">        This contains a representation of the information stored within the</span>
<span class="sd">        workflow configuration files</span>
<span class="sd">    scienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        This contains the times that the workflow is expected to analyse.</span>
<span class="sd">    outputDir : path</span>
<span class="sd">        All output files written by datafind processes will be written to this</span>
<span class="sd">        directory.</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]). This</span>
<span class="sd">        is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>
<span class="sd">        FIXME: Filenames may not be unique with current codes!</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafindcaches : list of glue.lal.Cache instances</span>
<span class="sd">       The glue.lal.Cache representations of the various calls to the datafind</span>
<span class="sd">       server and the returned frame files.</span>
<span class="sd">    datafindOuts : pycbc.workflow.core.FileList</span>
<span class="sd">        List of all the datafind output files for use later in the pipeline.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
        <span class="n">setup_datafind_runtime_cache_single_call_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                                        <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

    <span class="n">datafindouts</span> <span class="o">=</span> <span class="n">convert_cachelist_to_filelist</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span>
</div>
<div class="viewcode-block" id="setup_datafind_runtime_frames_multi_calls_perifo"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_runtime_frames_multi_calls_perifo">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_runtime_frames_multi_calls_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                                     <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function uses the glue.datafind library to obtain the location of all</span>
<span class="sd">    the frame files that will be needed to cover the analysis of the data</span>
<span class="sd">    given in scienceSegs. This function will not check if the returned frames</span>
<span class="sd">    cover the whole time requested, such sanity checks are done in the</span>
<span class="sd">    pycbc.workflow.setup_datafind_workflow entry function. As opposed to</span>
<span class="sd">    setup_datafind_runtime_single_call_perifo this call will one call to the</span>
<span class="sd">    datafind server for every science segment. This function will return a list</span>
<span class="sd">    of files corresponding to the individual frames returned by the datafind</span>
<span class="sd">    query. This will allow pegasus to more easily identify all the files used</span>
<span class="sd">    as input, but may cause problems for codes that need to take frame cache</span>
<span class="sd">    files as input.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    cp : ConfigParser.ConfigParser instance</span>
<span class="sd">        This contains a representation of the information stored within the</span>
<span class="sd">        workflow configuration files</span>
<span class="sd">    scienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        This contains the times that the workflow is expected to analyse.</span>
<span class="sd">    outputDir : path</span>
<span class="sd">        All output files written by datafind processes will be written to this</span>
<span class="sd">        directory.</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]). This</span>
<span class="sd">        is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>
<span class="sd">        FIXME: Filenames may not be unique with current codes!</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafindcaches : list of glue.lal.Cache instances</span>
<span class="sd">       The glue.lal.Cache representations of the various calls to the datafind</span>
<span class="sd">       server and the returned frame files.</span>
<span class="sd">    datafindOuts : pycbc.workflow.core.FileList</span>
<span class="sd">        List of all the datafind output files for use later in the pipeline.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
        <span class="n">setup_datafind_runtime_cache_multi_calls_perifo</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">scienceSegs</span><span class="p">,</span>
                                                        <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>

    <span class="n">datafindouts</span> <span class="o">=</span> <span class="n">convert_cachelist_to_filelist</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span>
</div>
<div class="viewcode-block" id="setup_datafind_from_pregenerated_lcf_files"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_from_pregenerated_lcf_files">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_from_pregenerated_lcf_files</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">ifos</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used if you want to run with pregenerated lcf frame</span>
<span class="sd">    cache files. </span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    cp : ConfigParser.ConfigParser instance</span>
<span class="sd">        This contains a representation of the information stored within the</span>
<span class="sd">        workflow configuration files</span>
<span class="sd">    ifos : list of ifo strings</span>
<span class="sd">        List of ifos to get pregenerated files for.</span>
<span class="sd">    outputDir : path</span>
<span class="sd">        All output files written by datafind processes will be written to this</span>
<span class="sd">        directory. Currently this sub-module writes no output.</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]).</span>
<span class="sd">        This is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafindcaches : list of glue.lal.Cache instances</span>
<span class="sd">       The glue.lal.Cache representations of the various calls to the datafind</span>
<span class="sd">       server and the returned frame files.</span>
<span class="sd">    datafindOuts : pycbc.workflow.core.FileList</span>
<span class="sd">        List of all the datafind output files for use later in the pipeline.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">datafindcaches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ifo</span> <span class="ow">in</span> <span class="n">ifos</span><span class="p">:</span>
        <span class="n">search_string</span> <span class="o">=</span> <span class="s">&quot;datafind-pregenerated-cache-file-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">ifo</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span>
        <span class="n">frame_cache_file_name</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                                <span class="n">search_string</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
        <span class="n">curr_cache</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">Cache</span><span class="o">.</span><span class="n">fromfilenames</span><span class="p">([</span><span class="n">frame_cache_file_name</span><span class="p">],</span>
                                             <span class="n">coltype</span><span class="o">=</span><span class="n">lal</span><span class="o">.</span><span class="n">LIGOTimeGPS</span><span class="p">)</span>
        <span class="n">curr_cache</span><span class="o">.</span><span class="n">ifo</span> <span class="o">=</span> <span class="n">ifo</span>
        <span class="n">datafindcaches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_cache</span><span class="p">)</span>
    <span class="n">datafindouts</span> <span class="o">=</span> <span class="n">convert_cachelist_to_filelist</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datafindcaches</span><span class="p">,</span> <span class="n">datafindouts</span>
</div>
<div class="viewcode-block" id="convert_cachelist_to_filelist"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.convert_cachelist_to_filelist">[docs]</a><span class="k">def</span> <span class="nf">convert_cachelist_to_filelist</span><span class="p">(</span><span class="n">datafindcache_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take as input a list of glue.lal.Cache objects and return a pycbc FileList</span>
<span class="sd">    containing all frames within those caches.</span>
<span class="sd">   </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    datafindcache_list : list of glue.lal.Cache objects</span>
<span class="sd">        The list of cache files to convert.</span>
<span class="sd">  </span>
<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    datafind_filelist : FileList of frame File objects</span>
<span class="sd">        The list of frame files.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">datafind_filelist</span> <span class="o">=</span> <span class="n">FileList</span><span class="p">([])</span>
    <span class="n">prev_file</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">cache</span> <span class="ow">in</span> <span class="n">datafindcache_list</span><span class="p">:</span>
        <span class="n">curr_ifo</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">ifo</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="c"># Don&#39;t add a new workflow file entry for this frame if</span>
            <span class="c"># if is a duplicate. These are assumed to be returned in time</span>
            <span class="c"># order</span>
            <span class="k">if</span> <span class="n">prev_file</span> <span class="ow">and</span> <span class="n">prev_file</span><span class="o">.</span><span class="n">cache_entry</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># Pegasus doesn&#39;t like &quot;localhost&quot; in URLs.</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;file://localhost&#39;</span><span class="p">,</span><span class="s">&#39;file://&#39;</span><span class="p">)</span>

            <span class="n">currFile</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="n">curr_ifo</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="n">frame</span><span class="o">.</span><span class="n">segment</span><span class="p">,</span> <span class="n">file_url</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">use_tmp_subdirs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;file://&#39;</span><span class="p">):</span>
                <span class="n">currFile</span><span class="o">.</span><span class="n">PFN</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">currFile</span><span class="o">.</span><span class="n">PFN</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s">&#39;notlocal&#39;</span><span class="p">)</span>
            <span class="n">datafind_filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currFile</span><span class="p">)</span>
            <span class="n">prev_file</span> <span class="o">=</span> <span class="n">currFile</span>
    <span class="k">return</span> <span class="n">datafind_filelist</span>

</div>
<div class="viewcode-block" id="get_science_segs_from_datafind_outs"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.get_science_segs_from_datafind_outs">[docs]</a><span class="k">def</span> <span class="nf">get_science_segs_from_datafind_outs</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will calculate the science segments that are covered in</span>
<span class="sd">    the OutGroupList containing the frame files returned by various</span>
<span class="sd">    calls to the datafind server. This can then be used to check whether this</span>
<span class="sd">    list covers what it is expected to cover.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datafindcaches : OutGroupList</span>
<span class="sd">        List of all the datafind output files.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    newScienceSegs : Dictionary of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        The times covered by the frames found in datafindOuts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newScienceSegs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">cache</span> <span class="ow">in</span> <span class="n">datafindcaches</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">groupSegs</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">segment</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">)</span><span class="o">.</span><span class="n">coalesce</span><span class="p">()</span>
            <span class="n">ifo</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">ifo</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newScienceSegs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">ifo</span><span class="p">):</span>
                <span class="n">newScienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">groupSegs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newScienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">groupSegs</span><span class="p">)</span>
                <span class="n">newScienceSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span><span class="o">.</span><span class="n">coalesce</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">newScienceSegs</span>
</div>
<div class="viewcode-block" id="get_missing_segs_from_frame_file_cache"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.get_missing_segs_from_frame_file_cache">[docs]</a><span class="k">def</span> <span class="nf">get_missing_segs_from_frame_file_cache</span><span class="p">(</span><span class="n">datafindcaches</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will use os.path.isfile to determine if all the frame files</span>
<span class="sd">    returned by the local datafind server actually exist on the disk. This can</span>
<span class="sd">    then be used to update the science times if needed.</span>
<span class="sd">   </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    datafindcaches : OutGroupList</span>
<span class="sd">        List of all the datafind output files.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    missingFrameSegs : Dict. of ifo keyed glue.segment.segmentlist instances</span>
<span class="sd">        The times corresponding to missing frames found in datafindOuts.</span>
<span class="sd">    missingFrames: Dict. of ifo keyed lal.Cache instances</span>
<span class="sd">        The list of missing frames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missingFrameSegs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">missingFrames</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">cache</span> <span class="ow">in</span> <span class="n">datafindcaches</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Don&#39;t bother if these are not file:// urls, assume all urls in</span>
            <span class="c"># one cache file must be the same type</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cache</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">&#39;file&#39;</span><span class="p">:</span>
                <span class="n">warn_msg</span> <span class="o">=</span> <span class="s">&quot;We have </span><span class="si">%s</span><span class="s"> entries in the &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scheme</span><span class="p">,)</span>
                <span class="n">warn_msg</span> <span class="o">+=</span> <span class="s">&quot;cache file. I do not check if these exist.&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">currMissingFrames</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">checkfilesexist</span><span class="p">(</span><span class="n">on_missing</span><span class="o">=</span><span class="s">&quot;warn&quot;</span><span class="p">)</span>
            <span class="n">missingSegs</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">segment</span> \
                                         <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">currMissingFrames</span><span class="p">)</span><span class="o">.</span><span class="n">coalesce</span><span class="p">()</span>
            <span class="n">ifo</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">ifo</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">missingFrameSegs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">ifo</span><span class="p">):</span>
                <span class="n">missingFrameSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">missingSegs</span>
                <span class="n">missingFrames</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span> <span class="o">=</span> <span class="n">lal</span><span class="o">.</span><span class="n">Cache</span><span class="p">(</span><span class="n">currMissingFrames</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">missingFrameSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">missingSegs</span><span class="p">)</span>
                <span class="c"># NOTE: This .coalesce probably isn&#39;t needed as the segments</span>
                <span class="c"># should be disjoint. If speed becomes an issue maybe remove it?</span>
                <span class="n">missingFrameSegs</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span><span class="o">.</span><span class="n">coalesce</span><span class="p">()</span>
                <span class="n">missingFrames</span><span class="p">[</span><span class="n">ifo</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">currMissingFrames</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">missingFrameSegs</span><span class="p">,</span> <span class="n">missingFrames</span>
</div>
<div class="viewcode-block" id="setup_datafind_server_connection"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.setup_datafind_server_connection">[docs]</a><span class="k">def</span> <span class="nf">setup_datafind_server_connection</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is resposible for setting up the connection with the datafind</span>
<span class="sd">    server.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    cp : pycbc.workflow.configuration.WorkflowConfigParser</span>
<span class="sd">        The memory representation of the ConfigParser</span>
<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    connection</span>
<span class="sd">        The open connection to the datafind server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_option_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                          <span class="s">&quot;datafind-ligo-datafind-server&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">]):</span>
        <span class="n">datafind_server</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_opt_tags</span><span class="p">(</span><span class="s">&quot;workflow-datafind&quot;</span><span class="p">,</span>
                                        <span class="s">&quot;datafind-ligo-datafind-server&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">datafind_server</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="k">return</span> <span class="n">datafind_connection</span><span class="p">(</span><span class="n">datafind_server</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_segment_summary_times"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.get_segment_summary_times">[docs]</a><span class="k">def</span> <span class="nf">get_segment_summary_times</span><span class="p">(</span><span class="n">scienceFile</span><span class="p">,</span> <span class="n">segmentName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will find the times for which the segment_summary is set</span>
<span class="sd">    for the flag given by segmentName.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    scienceFile : SegFile</span>
<span class="sd">        The segment file that we want to use to determine this.</span>
<span class="sd">    segmentName : string</span>
<span class="sd">        The DQ flag to search for times in the segment_summary table.</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    summSegList : glue.segments.segmentlist</span>
<span class="sd">        The times that are covered in the segment summary table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Parse the segmentName</span>
    <span class="n">segmentName</span> <span class="o">=</span> <span class="n">segmentName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">segmentName</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid channel name </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">segmentName</span><span class="p">))</span>
    <span class="n">ifo</span> <span class="o">=</span> <span class="n">segmentName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">segmentName</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segmentName</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">segmentName</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c"># Load the filename</span>
    <span class="n">xmldoc</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_filename</span><span class="p">(</span><span class="n">scienceFile</span><span class="o">.</span><span class="n">cache_entry</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                             <span class="n">gz</span><span class="o">=</span><span class="n">scienceFile</span><span class="o">.</span><span class="n">cache_entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;gz&quot;</span><span class="p">),</span>
                             <span class="n">contenthandler</span><span class="o">=</span><span class="n">ContentHandler</span><span class="p">)</span>

    <span class="c"># Get the segment_def_id for the segmentName</span>
    <span class="n">segmentDefTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">xmldoc</span><span class="p">,</span> <span class="s">&quot;segment_definer&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">segmentDefTable</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">ifos</span> <span class="o">==</span> <span class="n">ifo</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">channel</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segmentName</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">version</span><span class="o">==</span><span class="n">version</span><span class="p">):</span>
                <span class="n">segDefID</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">segment_def_id</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Cannot find channel </span><span class="si">%s</span><span class="s"> in segment_definer table.&quot;</span>\
                         <span class="o">%</span><span class="p">(</span><span class="n">segmentName</span><span class="p">))</span>

    <span class="c"># Get the segmentlist corresponding to this segmentName in segment_summary</span>
    <span class="n">segmentSummTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">xmldoc</span><span class="p">,</span> <span class="s">&quot;segment_summary&quot;</span><span class="p">)</span>
    <span class="n">summSegList</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segmentlist</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">segmentSummTable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">segment_def_id</span> <span class="o">==</span> <span class="n">segDefID</span><span class="p">:</span>
            <span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
            <span class="n">summSegList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
    <span class="n">summSegList</span><span class="o">.</span><span class="n">coalesce</span><span class="p">()</span>
   
    <span class="k">return</span> <span class="n">summSegList</span>
</div>
<div class="viewcode-block" id="run_datafind_instance"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.run_datafind_instance">[docs]</a><span class="k">def</span> <span class="nf">run_datafind_instance</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">outputDir</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span>
                          <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">ifo</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will query the datafind server once to find frames between</span>
<span class="sd">    the specified times for the specified frame type and observatory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cp : ConfigParser instance</span>
<span class="sd">        This is used to find any kwArgs that should be sent to the datafind</span>
<span class="sd">        mod</span>
<span class="sd">    outputDir : Output cache files will be written here. We also write the</span>
<span class="sd">        commands for reproducing what is done in this function to this</span>
<span class="sd">        directory.</span>
<span class="sd">    connection : datafind connection object</span>
<span class="sd">        Initialized through the glue.datafind module, this is the open</span>
<span class="sd">        connection to the datafind server.</span>
<span class="sd">    observatory : string</span>
<span class="sd">        The observatory to query frames for. This is &#39;H&#39;, &#39;L&#39; or &#39;V&#39; and not</span>
<span class="sd">        the usual &#39;H1&#39;, &#39;L1&#39;, &#39;V1&#39; ... because.</span>
<span class="sd">    frameType : string</span>
<span class="sd">        The frame type to query for.</span>
<span class="sd">    startTime : int</span>
<span class="sd">        Integer start time to query the datafind server for frames.</span>
<span class="sd">    endTime : int</span>
<span class="sd">        Integer end time to query the datafind server for frames.</span>
<span class="sd">    ifo : string</span>
<span class="sd">        The interferometer to use for naming output. This is &#39;H1&#39;, &#39;L1&#39;, &#39;V1&#39;,</span>
<span class="sd">        etc. Maybe this could be merged with the observatory string, but this</span>
<span class="sd">        could cause issues if running on old &#39;H2&#39; and &#39;H1&#39; data.</span>
<span class="sd">    tag : string, optional (default=None)</span>
<span class="sd">        Use this to specify a tag. This can be used if this module is being</span>
<span class="sd">        called more than once to give call specific configuration (by setting</span>
<span class="sd">        options in [workflow-datafind-${TAG}] rather than [workflow-datafind]). This</span>
<span class="sd">        is also used to tag the Files returned by the class to uniqueify</span>
<span class="sd">        the Files and uniqueify the actual filename.</span>
<span class="sd">        FIXME: Filenames may not be unique with current codes!</span>


<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dfCache : glue.lal.Cache instance</span>
<span class="sd">       The glue.lal.Cache representation of the call to the datafind</span>
<span class="sd">       server and the returned frame files.</span>
<span class="sd">    cacheFile : pycbc.workflow.core.File</span>
<span class="sd">        Cache file listing all of the datafind output files for use later in the pipeline.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seg</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">([</span><span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
        <span class="n">currTags</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">currTags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Take the datafind KWargs from config (usually urltype=file is</span>
    <span class="c"># given).</span>
    <span class="n">dfKwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># By default ignore missing frames, this case is dealt with outside of here</span>
    <span class="n">dfKwargs</span><span class="p">[</span><span class="s">&#39;on_gaps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ignore&#39;</span>
    <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s">&quot;datafind&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&quot;datafind&quot;</span><span class="p">):</span>
            <span class="n">dfKwargs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s">&#39;datafind-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">tag</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&quot;datafind-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">tag</span><span class="p">)):</span>
                <span class="n">dfKwargs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c"># It is useful to print the corresponding command to the logs</span>
    <span class="c"># directory to check if this was expected.</span>
    <span class="n">log_datafind_command</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span>
                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span><span class="s">&#39;logs&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">dfKwargs</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Asking datafind server for frames.&quot;</span><span class="p">)</span>
    <span class="n">dfCache</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">find_frame_urls</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span> 
                                        <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span> <span class="o">**</span><span class="n">dfKwargs</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Frames returned&quot;</span><span class="p">)</span>
    <span class="c"># workflow format output file</span>
    <span class="n">cache_file</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="n">ifo</span><span class="p">,</span> <span class="s">&#39;DATAFIND&#39;</span><span class="p">,</span> <span class="n">seg</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s">&#39;lcf&#39;</span><span class="p">,</span>
                      <span class="n">directory</span><span class="o">=</span><span class="n">outputDir</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">currTags</span><span class="p">)</span>
    <span class="n">dfCache</span><span class="o">.</span><span class="n">ifo</span> <span class="o">=</span> <span class="n">ifo</span>
    <span class="c"># Dump output to file</span>
    <span class="n">fP</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
    <span class="c"># FIXME: CANNOT use dfCache.tofile because it will print 815901601.00000</span>
    <span class="c">#        as a gps time which is incompatible with the lal cache format</span>
    <span class="c">#        (and the C codes) which demand an integer.</span>
    <span class="c">#dfCache.tofile(fP)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dfCache</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">segment</span><span class="p">)))</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">fP</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> \
            <span class="o">%</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">observatory</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">segment</span> <span class="o">=</span> <span class="n">segments</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">fP</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfCache</span><span class="p">,</span> <span class="n">cache_file</span>

</div>
<div class="viewcode-block" id="log_datafind_command"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.log_datafind_command">[docs]</a><span class="k">def</span> <span class="nf">log_datafind_command</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span>
                         <span class="n">outputDir</span><span class="p">,</span> <span class="o">**</span><span class="n">dfKwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This command will print an equivalent gw_data_find command to disk that</span>
<span class="sd">    can be used to debug why the internal datafind module is not working.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># FIXME: This does not accurately reproduce the call as assuming the</span>
    <span class="c"># kwargs will be the same is wrong, so some things need to be converted</span>
    <span class="c"># &quot;properly&quot; to the command line equivalent.</span>
    <span class="n">gw_command</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;gw_data_find&#39;</span><span class="p">,</span> <span class="s">&#39;--observatory&#39;</span><span class="p">,</span> <span class="n">observatory</span><span class="p">,</span>
                  <span class="s">&#39;--type&#39;</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span>
                  <span class="s">&#39;--gps-start-time&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">startTime</span><span class="p">),</span>
                  <span class="s">&#39;--gps-end-time&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">endTime</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dfKwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;match&#39;</span><span class="p">:</span>
            <span class="n">gw_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;--match&quot;</span><span class="p">)</span>
            <span class="n">gw_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;urltype&#39;</span><span class="p">:</span>
            <span class="n">gw_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;--url-type&quot;</span><span class="p">)</span>
            <span class="n">gw_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;on_gaps&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errMsg</span> <span class="o">=</span> <span class="s">&quot;Unknown datafind kwarg given: </span><span class="si">%s</span><span class="s">. &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">errMsg</span><span class="o">+=</span> <span class="s">&quot;This argument is stripped in the logged .sh command.&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>
  
    <span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%d</span><span class="s">-</span><span class="si">%d</span><span class="s">.sh&quot;</span> \
               <span class="o">%</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">frameType</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="o">-</span><span class="n">startTime</span><span class="p">)</span>
    <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputDir</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
    <span class="n">fP</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">fP</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gw_command</span><span class="p">))</span>
    <span class="n">fP</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="datafind_keep_unique_backups"><a class="viewcode-back" href="../../../pycbc.workflow.html#pycbc.workflow.datafind.datafind_keep_unique_backups">[docs]</a><span class="k">def</span> <span class="nf">datafind_keep_unique_backups</span><span class="p">(</span><span class="n">backup_outs</span><span class="p">,</span> <span class="n">orig_outs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function will take a list of backup datafind files, presumably</span>
<span class="sd">    obtained by querying a remote datafind server, e.g. CIT, and compares</span>
<span class="sd">    these against a list of original datafind files, presumably obtained by</span>
<span class="sd">    querying the local datafind server. Only the datafind files in the backup</span>
<span class="sd">    list that do not appear in the original list are returned. This allows us</span>
<span class="sd">    to use only files that are missing from the local cluster.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    backup_outs : FileList</span>
<span class="sd">        List of datafind files from the remote datafind server.</span>
<span class="sd">    orig_outs : FileList</span>
<span class="sd">        List of datafind files from the local datafind server.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    FileList</span>
<span class="sd">        List of datafind files in backup_outs and not in orig_outs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># NOTE: This function is not optimized and could be made considerably</span>
    <span class="c">#       quicker if speed becomes in issue. With 4s frame files this might</span>
    <span class="c">#       be slow, but for &gt;1000s files I don&#39;t foresee any issue, so I keep</span>
    <span class="c">#       this simple.</span>
    <span class="n">return_list</span> <span class="o">=</span> <span class="n">FileList</span><span class="p">([])</span>
    <span class="c"># We compare the LFNs to determine uniqueness</span>
    <span class="c"># Is there a way to associate two paths with one LFN??</span>
    <span class="n">orig_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">orig_outs</span><span class="p">]</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">backup_outs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orig_names</span><span class="p">:</span>
            <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_num</span> <span class="o">=</span> <span class="n">orig_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">orig_out</span> <span class="o">=</span> <span class="n">orig_outs</span><span class="p">[</span><span class="n">index_num</span><span class="p">]</span>
            <span class="n">pfns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">pfns</span><span class="p">)</span>
            <span class="c"># This shouldn&#39;t happen, but catch if it does</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pfns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">orig_out</span><span class="o">.</span><span class="n">PFN</span><span class="p">(</span><span class="n">pfns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s">&#39;notlocal&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">return_list</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Alexander Nitz.
      Last updated on Sep 08, 2015.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>