

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pycbc.tmpltbank.calc_moments &mdash; PyCBC 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyCBC 0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="pycbc" href="../../pycbc.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../../index.html" class="icon icon-home"> PyCBC
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing PyCBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#setting-up-a-virtual-environment-for-installing-pycbc">Setting up a virtual environment for installing PyCBC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install_virtualenv.html">Setting up virtualenv</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install_virtualenv.html#install-pip">Install pip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../install_virtualenv.html#install-virtualenv">Install virtualenv</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing-lalsuite-into-a-virtual-environment">Installing lalsuite into a virtual environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install_lalsuite.html">Installing lalsuite for PyCBC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install_lalsuite.html#obtaining-the-source-code-and-checking-out-a-version">Obtaining the source code and checking out a version</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../install_lalsuite.html#building-and-installing-into-your-virtual-environment">Building and installing into your virtual environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing-pycbc-in-a-virtual-environment">Installing PyCBC in a virtual environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install.html#installing-a-released-version-of-pycbc">Installing a released version of PyCBC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../install.html#installing-source-from-github-for-development">Installing source from GitHub for development</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#building-and-installing-documentation">Building and Installing Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../build_gh_pages.html">Building Documentation for Git Hub Pages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../build_gh_pages.html#creating-a-git-hub-project-page">Creating a Git Hub project page</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../build_gh_pages.html#building-and-pushing-the-documentation">Building and pushing the documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#modifying-pycbc-glue-and-pycbc-pylal">Modifying pycbc-glue and pycbc-pylal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#use-of-intel-mkl-optimized-fft-libraries">Use of Intel MKL Optimized FFT libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#graphics-processing-unit-support-with-cuda">Graphics Processing Unit support with CUDA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../install_cuda.html">Instructions to add CUDA support (optional)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../install_cuda.html#installing-the-cuda-dependencies">Installing the CUDA dependencies</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow.html">Workflow: the inspiral analysis workflow generator (<code class="docutils literal"><span class="pre">pycbc.workflow</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#workflow-to-do-list">Workflow to do list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pycbc-make-coinc-workflow"><code class="docutils literal"><span class="pre">pycbc_make_coinc_workflow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/pycbc_make_coinc_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_coinc_workflow</span></code>: A CBC analysis workflow generator</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pycbc-make-sngl-workflow"><code class="docutils literal"><span class="pre">pycbc_make_sngl_workflow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/pycbc_make_sngl_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_sngl_workflow</span></code>: A single-ifo detchar tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pycbc-make-daily-workflow"><code class="docutils literal"><span class="pre">pycbc_make_daily_workflow</span></code></a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#data-checker"><cite>data_checker</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#pygrb"><code class="docutils literal"><span class="pre">pygrb</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/pygrb.html">PyGRB: A GRB triggered CBC analysis workflow generator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#workflow-module-documentation">Workflow module documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#initialization">Initialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/initialization.html">Pycbc&#8217;s workflow module configuration file(s) and command line interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#generating-segments">Generating segments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/segments.html">The workflow segment generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#obtaining-data">Obtaining data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/datafind.html">The workflow datafind and validation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#injection-generation">Injection generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/injections.html">The workflow injection generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#time-slide-generation">Time-slide generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/time_slides.html">The workflow time-slide generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#template-bank">Template bank</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/template_bank.html">The workflow template bank generation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#split-table">Split table</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/splittable.html">The workflow table splitting module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#matched-filtering">Matched-filtering</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/matched_filter.html">The workflow matched-filter module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#coincidence">Coincidence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/coincidence.html">The workflow coincidence module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#post-processing-preparation">Post processing preparation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/postprocprep.html">The workflow postprocessing preparation module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../workflow.html#post-processing">Post-processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../workflow/postproc.html">The workflow postprocessing module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow.html#method-documentation">Method documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.workflow.html">pycbc.workflow package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.analysislogging">pycbc.workflow.analysislogging module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.coincidence">pycbc.workflow.coincidence module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.configparser_test">pycbc.workflow.configparser_test module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.configuration">pycbc.workflow.configuration module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.core">pycbc.workflow.core module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.datafind">pycbc.workflow.datafind module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.injection">pycbc.workflow.injection module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.jobsetup">pycbc.workflow.jobsetup module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.legacy_ihope">pycbc.workflow.legacy_ihope module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.matched_filter">pycbc.workflow.matched_filter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.pegasus_workflow">pycbc.workflow.pegasus_workflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.plotting">pycbc.workflow.plotting module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.postprocessing">pycbc.workflow.postprocessing module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.postprocessing_prep">pycbc.workflow.postprocessing_prep module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.segment">pycbc.workflow.segment module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.splittable">pycbc.workflow.splittable module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.summaryplots">pycbc.workflow.summaryplots module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.timeslides">pycbc.workflow.timeslides module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow.tmpltbank">pycbc.workflow.tmpltbank module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.workflow.html#module-pycbc.workflow">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tmpltbank.html">PyCBC template bank generation documentation (<code class="docutils literal"><span class="pre">pycbc.tmpltbank</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#non-spin-bank-placement-pycbc-geom-nonspinbank">Non spin bank placement: pycbc_geom_nonspinbank</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#some-examples">Some examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options">Command line options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#aligned-spin-geometric-placement-pycbc-geom-aligned-bank">Aligned-spin geometric placement: pycbc_geom_aligned_bank</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id1">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id2">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id3">Some examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id4">Command line options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#aligned-spin-stochastic-placement">Aligned-spin stochastic placement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id5">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id6">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#ian-s-recommendation-which-stochastic-code-should-i-use">Ian&#8217;s recommendation: Which stochastic code should I use?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tmpltbank.html#i-want-to-use-the-f2-or-r2f4-metric">I want to use the F2 or R2F4 metric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tmpltbank.html#i-want-to-use-another-metric-ie-an-imr-metric">I want to use another metric, ie. an IMR metric</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tmpltbank.html#i-want-to-use-direct-match">I want to use direct match</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#id7">Some examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options-pycbc-aligned-stoch-bank">Command line options: pycbc_aligned_stoch_bank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options-lalapps-cbc-sbank">Command line options: lalapps_cbc_sbank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tmpltbank.html#command-line-options-lalapps-cbc-sbank-pipe">Command line options: lalapps_cbc_sbank_pipe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#hybrid-approaches-the-best-of-both-worlds">Hybrid approaches: the best of both worlds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tmpltbank.html#the-module-s-source-code">The module&#8217;s source code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.tmpltbank.html">pycbc.tmpltbank package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.bank_output_utils">pycbc.tmpltbank.bank_output_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.brute_force_methods">pycbc.tmpltbank.brute_force_methods module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.calc_moments">pycbc.tmpltbank.calc_moments module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.coord_utils">pycbc.tmpltbank.coord_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.em_progenitors">pycbc.tmpltbank.em_progenitors module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.lambda_mapping">pycbc.tmpltbank.lambda_mapping module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.lattice_utils">pycbc.tmpltbank.lattice_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.option_utils">pycbc.tmpltbank.option_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank.partitioned_bank">pycbc.tmpltbank.partitioned_bank module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.tmpltbank.html#module-pycbc.tmpltbank">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.psd.html">pycbc.psd package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd.analytical">pycbc.psd.analytical module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd.estimate">pycbc.psd.estimate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd.read">pycbc.psd.read module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.psd.html#module-pycbc.psd">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../pycbc.noise.html">pycbc.noise package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.noise.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.noise.html#module-pycbc.noise.gaussian">pycbc.noise.gaussian module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pycbc.noise.html#module-pycbc.noise">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../frame.html">Reading Gravitational-wave Frames (<code class="docutils literal"><span class="pre">pycbc.frame</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../frame.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../frame.html#module-pycbc.frame">Method documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../banksim.html">Dag Generator for Doing Banksims</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../banksim.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../banksim.html#how-to-generate-a-workflow-to-do-a-large-banksim">How to generate a workflow to do a large banksim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#creating-an-ini-file">Creating an INI file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#generating-the-workflow">Generating the workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#understanding-the-results">Understanding the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#workflow-considerations">Workflow considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../banksim.html#example-config-files">Example config files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faithsim.html">Dag Generator for Doing Faithfulness Comparisons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../faithsim.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faithsim.html#how-to-generate-a-workflow">How to generate a workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#creating-a-configuration-ini-file">Creating a configuration (.ini) file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#generating-the-workflow">Generating the workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#understanding-the-results">Understanding the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faithsim.html#example-config-files">Example config files</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow/pycbc_bns_hdf_config_walkthrough.html">Walkthrough of running the PyCBC BNS focused pipeline on SUGAR</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow/pycbc_bns_hdf_config_walkthrough.html#run-sh">run.sh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../workflow/pycbc_bns_hdf_config_walkthrough.html#config-file">config file</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../waveform.html">Waveforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#what-waveforms-can-i-generate">What waveforms can I generate?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-time-domain-waveforms">Plotting Time Domain Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#calculating-the-match-between-waveforms">Calculating the match between waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-a-td-and-fd-waveform-together-in-the-td">Plotting a TD and FD waveform together in the TD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-gw-phase-and-amplitude-of-td-waveform">Plotting GW phase and amplitude of TD waveform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../waveform.html#plotting-frequency-evolution-of-td-waveform">Plotting frequency evolution of TD waveform</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">Documenting PyCBC code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#sphinx">Sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#documenting-the-pycbc-package">Documenting the PyCBC package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#documenting-pycbc-modules">Documenting PyCBC modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation.html#documenting-pycbc-scripts">Documenting PyCBC scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Creating Releases of PyCBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../release.html#creating-the-release-on-github">Creating the release on GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../release.html#uploading-to-the-python-package-index">Uploading to the Python Package Index</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../formats/hdf_format.html">HDF files within the PyCBC workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../formats/hdf_format.html#single-inspiral-triggers">single inspiral triggers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#executables">Executables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#specification">Specification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../formats/hdf_format.html#combined-single-inspiral-triggers">combined single inspiral triggers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#id1">Executables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#id2">Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../formats/hdf_format.html#example-uses">Example uses</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">PyCBC</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../pycbc.html">pycbc</a> &raquo;</li>
      
    <li>pycbc.tmpltbank.calc_moments</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pycbc.tmpltbank.calc_moments</h1><div class="highlight"><pre>
<span class="c"># Copyright (C) 2013 Ian W. Harry</span>
<span class="c">#</span>
<span class="c"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c"># under the terms of the GNU General Public License as published by the</span>
<span class="c"># Free Software Foundation; either version 3 of the License, or (at your</span>
<span class="c"># option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful, but</span>
<span class="c"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="c"># Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License along</span>
<span class="c"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c"># 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pycbc.tmpltbank.lambda_mapping</span> <span class="kn">import</span> <span class="n">generate_mapping</span>
        

<div class="viewcode-block" id="determine_eigen_directions"><a class="viewcode-back" href="../../../pycbc.tmpltbank.html#pycbc.tmpltbank.calc_moments.determine_eigen_directions">[docs]</a><span class="k">def</span> <span class="nf">determine_eigen_directions</span><span class="p">(</span><span class="n">metricParams</span><span class="p">,</span> <span class="n">preserveMoments</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                               <span class="n">vary_fmax</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will calculate the coordinate transfomations that are needed</span>
<span class="sd">    to rotate from a coordinate system described by the various Lambda</span>
<span class="sd">    components in the frequency expansion, to a coordinate system where the</span>
<span class="sd">    metric is Cartesian.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    metricParams : metricParameters instance</span>
<span class="sd">        Structure holding all the options for construction of the metric.</span>
<span class="sd">    preserveMoments : boolean, optional (default False)</span>
<span class="sd">        Currently only used for debugging.</span>
<span class="sd">        If this is given then if the moments structure is already set</span>
<span class="sd">        within metricParams then they will not be recalculated.</span>
<span class="sd">    vary_fmax : boolean, optional (default False)</span>
<span class="sd">        If set to False the metric and rotations are calculated once, for the</span>
<span class="sd">        full range of frequency [f_low,f_upper).</span>
<span class="sd">        If set to True the metric and rotations are calculated multiple times,</span>
<span class="sd">        for frequency ranges [f_low,f_low + i*vary_density), where i starts at </span>
<span class="sd">        1 and runs up until f_low + (i+1)*vary_density &gt; f_upper. </span>
<span class="sd">        Thus values greater than f_upper are *not* computed. </span>
<span class="sd">        The calculation for the full range [f_low,f_upper) is also done.</span>
<span class="sd">    vary_density : float, optional</span>
<span class="sd">        If vary_fmax is True, this will be used in computing the frequency</span>
<span class="sd">        ranges as described for vary_fmax.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    metricParams : metricParameters instance</span>
<span class="sd">        Structure holding all the options for construction of the metric.</span>
<span class="sd">        **THIS FUNCTION ONLY RETURNS THE CLASS**</span>
<span class="sd">        The following will be **added** to this structure</span>
<span class="sd">    metricParams.evals : Dictionary of numpy.array</span>
<span class="sd">        Each entry in the dictionary corresponds to the different frequency</span>
<span class="sd">        ranges described in vary_fmax. If vary_fmax = False, the only entry</span>
<span class="sd">        will be f_upper, this corresponds to integrals in [f_low,f_upper). This</span>
<span class="sd">        entry is always present. Each other entry will use floats as keys to</span>
<span class="sd">        the dictionary. These floats give the upper frequency cutoff when it is</span>
<span class="sd">        varying.</span>
<span class="sd">        Each numpy.array contains the eigenvalues which, with the eigenvectors</span>
<span class="sd">        in evecs, are needed to rotate the</span>
<span class="sd">        coordinate system to one in which the metric is the identity matrix. </span>
<span class="sd">    metricParams.evecs : Dictionary of numpy.matrix</span>
<span class="sd">        Each entry in the dictionary is as described under evals.</span>
<span class="sd">        Each numpy.matrix contains the eigenvectors which, with the eigenvalues</span>
<span class="sd">        in evals, are needed to rotate the</span>
<span class="sd">        coordinate system to one in which the metric is the identity matrix.</span>
<span class="sd">    metricParams.metric : Dictionary of numpy.matrix</span>
<span class="sd">        Each entry in the dictionary is as described under evals.</span>
<span class="sd">        Each numpy.matrix contains the metric of the parameter space in the</span>
<span class="sd">        Lambda_i coordinate system.</span>
<span class="sd">    metricParams.moments : Moments structure</span>
<span class="sd">        See the structure documentation for a description of this. This</span>
<span class="sd">        contains the result of all the integrals used in computing the metrics</span>
<span class="sd">        above. It can be used for the ethinca components calculation, or other</span>
<span class="sd">        similar calculations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   
    <span class="n">evals</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">evecs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">unmax_metric</span> <span class="o">=</span> <span class="p">{}</span>
  
    <span class="c"># First step is to get the moments needed to calculate the metric</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span> <span class="ow">and</span> <span class="n">preserveMoments</span><span class="p">):</span>
        <span class="n">get_moments</span><span class="p">(</span><span class="n">metricParams</span><span class="p">,</span> <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span>
                    <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="c"># What values are going to be in the moments</span>
    <span class="c"># J7 is the normalization factor so it *MUST* be present</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span><span class="p">[</span><span class="s">&#39;J7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="c"># We start looping over every item in the list of metrics</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
        <span class="c"># Here we convert the moments into a form easier to use here</span>
        <span class="n">Js</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
            <span class="n">Js</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span><span class="p">[</span><span class="s">&#39;J</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="n">item</span><span class="p">]</span>

        <span class="n">logJs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
            <span class="n">logJs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span><span class="p">[</span><span class="s">&#39;log</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="n">item</span><span class="p">]</span>

        <span class="n">loglogJs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
            <span class="n">loglogJs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span><span class="p">[</span><span class="s">&#39;loglog</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="n">item</span><span class="p">]</span>

        <span class="n">logloglogJs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
            <span class="n">logloglogJs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span><span class="p">[</span><span class="s">&#39;logloglog</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="n">item</span><span class="p">]</span>

        <span class="n">loglogloglogJs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
            <span class="n">loglogloglogJs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span><span class="p">[</span><span class="s">&#39;loglogloglog</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="n">item</span><span class="p">]</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="n">generate_mapping</span><span class="p">(</span><span class="n">metricParams</span><span class="o">.</span><span class="n">pnOrder</span><span class="p">)</span>
 
        <span class="c"># Calculate the metric</span>
        <span class="n">gs</span><span class="p">,</span> <span class="n">unmax_metric_curr</span> <span class="o">=</span> <span class="n">calculate_metric</span><span class="p">(</span><span class="n">Js</span><span class="p">,</span> <span class="n">logJs</span><span class="p">,</span> <span class="n">loglogJs</span><span class="p">,</span>
                                          <span class="n">logloglogJs</span><span class="p">,</span> <span class="n">loglogloglogJs</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
        <span class="n">metric</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">unmax_metric_curr</span>

        <span class="c"># And the eigenvalues</span>
        <span class="n">evals</span><span class="p">[</span><span class="n">item</span><span class="p">],</span><span class="n">evecs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>

        <span class="c"># Numerical error can lead to small negative eigenvalues.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">evals</span><span class="p">[</span><span class="n">item</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">evals</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="c">#                print &quot;WARNING: Negative eigenvalue %e. Setting as positive.&quot; \</span>
<span class="c">#                      %(evals[item][i])</span>
                <span class="n">evals</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">evals</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">evecs</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># We demand a convention that all diagonal terms in the matrix</span>
                <span class="c"># of eigenvalues are positive.</span>
                <span class="c"># This is done to help visualization of the spaces (increasing</span>
                <span class="c"># mchirp always goes the same way)</span>
                <span class="n">evecs</span><span class="p">[</span><span class="n">item</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">evecs</span><span class="p">[</span><span class="n">item</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span>

    <span class="n">metricParams</span><span class="o">.</span><span class="n">evals</span> <span class="o">=</span> <span class="n">evals</span>
    <span class="n">metricParams</span><span class="o">.</span><span class="n">evecs</span> <span class="o">=</span> <span class="n">evecs</span>
    <span class="n">metricParams</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
    <span class="n">metricParams</span><span class="o">.</span><span class="n">time_unprojected_metric</span> <span class="o">=</span> <span class="n">unmax_metric</span>
    
    <span class="k">return</span> <span class="n">metricParams</span>
</div>
<div class="viewcode-block" id="get_moments"><a class="viewcode-back" href="../../../pycbc.tmpltbank.html#pycbc.tmpltbank.calc_moments.get_moments">[docs]</a><span class="k">def</span> <span class="nf">get_moments</span><span class="p">(</span><span class="n">metricParams</span><span class="p">,</span> <span class="n">vary_fmax</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will calculate the various integrals (moments) that are</span>
<span class="sd">    needed to compute the metric used in template bank placement and</span>
<span class="sd">    coincidence.   </span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    metricParams : metricParameters instance</span>
<span class="sd">        Structure holding all the options for construction of the metric.</span>
<span class="sd">    vary_fmax : boolean, optional (default False)</span>
<span class="sd">        If set to False the metric and rotations are calculated once, for the</span>
<span class="sd">        full range of frequency [f_low,f_upper).</span>
<span class="sd">        If set to True the metric and rotations are calculated multiple times,</span>
<span class="sd">        for frequency ranges [f_low,f_low + i*vary_density), where i starts at </span>
<span class="sd">        1 and runs up until f_low + (i+1)*vary_density &gt; f_upper. </span>
<span class="sd">        Thus values greater than f_upper are *not* computed. </span>
<span class="sd">        The calculation for the full range [f_low,f_upper) is also done.</span>
<span class="sd">    vary_density : float, optional</span>
<span class="sd">        If vary_fmax is True, this will be used in computing the frequency</span>
<span class="sd">        ranges as described for vary_fmax.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    None : None</span>
<span class="sd">        **THIS FUNCTION RETURNS NOTHING**</span>
<span class="sd">        The following will be **added** to the metricParams structure</span>
<span class="sd">    metricParams.moments : Moments structure</span>
<span class="sd">        This contains the result of all the integrals used in computing the</span>
<span class="sd">        metrics above. It can be used for the ethinca components calculation,</span>
<span class="sd">        or other similar calculations. This is composed of two compound</span>
<span class="sd">        dictionaries. The first entry indicates which moment is being</span>
<span class="sd">        calculated and the second entry indicates the upper frequency cutoff</span>
<span class="sd">        that was used.</span>

<span class="sd">        In all cases x = f/f0.</span>

<span class="sd">        For the first entries the options are:</span>
<span class="sd">        </span>
<span class="sd">        moments[&#39;J%d&#39; %(i)][f_cutoff]</span>
<span class="sd">        This stores the integral of </span>
<span class="sd">        x**((-i)/3.) * delta X / PSD(x)</span>
<span class="sd">        </span>
<span class="sd">        moments[&#39;log%d&#39; %(i)][f_cutoff]</span>
<span class="sd">        This stores the integral of </span>
<span class="sd">        (numpy.log(x**(1./3.))) x**((-i)/3.) * delta X / PSD(x)</span>

<span class="sd">        moments[&#39;loglog%d&#39; %(i)][f_cutoff]</span>
<span class="sd">        This stores the integral of </span>
<span class="sd">        (numpy.log(x**(1./3.)))**2 x**((-i)/3.) * delta X / PSD(x)</span>

<span class="sd">        moments[&#39;loglog%d&#39; %(i)][f_cutoff]</span>
<span class="sd">        This stores the integral of </span>
<span class="sd">        (numpy.log(x**(1./3.)))**3 x**((-i)/3.) * delta X / PSD(x)</span>

<span class="sd">        moments[&#39;loglog%d&#39; %(i)][f_cutoff]</span>
<span class="sd">        This stores the integral of </span>
<span class="sd">        (numpy.log(x**(1./3.)))**4 x**((-i)/3.) * delta X / PSD(x)</span>

<span class="sd">        The second entry stores the frequency cutoff used when computing </span>
<span class="sd">        the integral. See description of the vary_fmax option above.</span>

<span class="sd">        All of these values are nomralized by a factor of</span>
<span class="sd">    </span>
<span class="sd">        x**((-7)/3.) * delta X / PSD(x)</span>
<span class="sd"> </span>
<span class="sd">        The normalization factor can be obtained in</span>

<span class="sd">        moments[&#39;I7&#39;][f_cutoff]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># NOTE: Unless the TaylorR2F4 metric is used the log^3 and log^4 terms are</span>
    <span class="c"># not needed. As this calculation is not too slow compared to bank</span>
    <span class="c"># placement we just do this anyway.</span>

    <span class="n">psd_amp</span> <span class="o">=</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">data</span>
    <span class="n">psd_f</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">psd_amp</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">deltaF</span> 
    <span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span> <span class="o">=</span> <span class="n">interpolate_psd</span><span class="p">(</span><span class="n">psd_f</span><span class="p">,</span> <span class="n">psd_amp</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">deltaF</span><span class="p">)</span>

    <span class="c"># Need I7 first as this is the normalization factor</span>
    <span class="n">funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">I7</span> <span class="o">=</span> <span class="n">calculate_moment</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">fLow</span><span class="p">,</span> \
                          <span class="n">metricParams</span><span class="o">.</span><span class="n">fUpper</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span>\
                          <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="c"># Do all the J moments</span>
    <span class="n">moments</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">moments</span><span class="p">[</span><span class="s">&#39;I7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I7</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
        <span class="n">funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">moments</span><span class="p">[</span><span class="s">&#39;J</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">calculate_moment</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">fLow</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">fUpper</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">I7</span><span class="p">,</span> \
                                <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="c"># Do the logx multiplied by some power terms</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
        <span class="n">funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)))</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">moments</span><span class="p">[</span><span class="s">&#39;log</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">calculate_moment</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">fLow</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">fUpper</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">I7</span><span class="p">,</span> \
                                <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="c"># Do the loglog term</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
        <span class="n">funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">moments</span><span class="p">[</span><span class="s">&#39;loglog</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">calculate_moment</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">fLow</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">fUpper</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">I7</span><span class="p">,</span> \
                                <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="c"># Do the logloglog term</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
        <span class="n">funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)))</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">moments</span><span class="p">[</span><span class="s">&#39;logloglog</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">calculate_moment</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">fLow</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">fUpper</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">I7</span><span class="p">,</span> \
                                <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="c"># Do the logloglog term</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
        <span class="n">funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)))</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">moments</span><span class="p">[</span><span class="s">&#39;loglogloglog</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">calculate_moment</span><span class="p">(</span><span class="n">new_f</span><span class="p">,</span> <span class="n">new_amp</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">fLow</span><span class="p">,</span> <span class="n">metricParams</span><span class="o">.</span><span class="n">fUpper</span><span class="p">,</span> \
                                <span class="n">metricParams</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">I7</span><span class="p">,</span> \
                                <span class="n">vary_fmax</span><span class="o">=</span><span class="n">vary_fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="n">vary_density</span><span class="p">)</span>

    <span class="n">metricParams</span><span class="o">.</span><span class="n">moments</span> <span class="o">=</span> <span class="n">moments</span>
</div>
<div class="viewcode-block" id="interpolate_psd"><a class="viewcode-back" href="../../../pycbc.tmpltbank.html#pycbc.tmpltbank.calc_moments.interpolate_psd">[docs]</a><span class="k">def</span> <span class="nf">interpolate_psd</span><span class="p">(</span><span class="n">psd_f</span><span class="p">,</span> <span class="n">psd_amp</span><span class="p">,</span> <span class="n">deltaF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to interpolate a PSD to a different value of deltaF. Uses linear</span>
<span class="sd">    interpolation. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    psd_f : numpy.array or list or similar</span>
<span class="sd">        List of the frequencies contained within the PSD.</span>
<span class="sd">    psd_amp : numpy.array or list or similar</span>
<span class="sd">        List of the PSD values at the frequencies in psd_f.</span>
<span class="sd">    deltaF : float</span>
<span class="sd">        Value of deltaF to interpolate the PSD to. </span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    new_psd_f : numpy.array</span>
<span class="sd">       Array of the frequencies contained within the interpolated PSD</span>
<span class="sd">    new_psd_amp : numpy.array</span>
<span class="sd">       Array of the interpolated PSD values at the frequencies in new_psd_f.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># In some cases this will be a no-op. I thought about removing this, but</span>
    <span class="c"># this function can take unequally sampled PSDs and it is difficult to</span>
    <span class="c"># check for this. As this function runs quickly anyway (compared to the</span>
    <span class="c"># moment calculation) I decided to always interpolate.</span>

    <span class="n">new_psd_f</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_psd_amp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fcurr</span> <span class="o">=</span> <span class="n">psd_f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">psd_f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">f_low</span> <span class="o">=</span> <span class="n">psd_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">f_high</span> <span class="o">=</span> <span class="n">psd_f</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">amp_low</span> <span class="o">=</span> <span class="n">psd_amp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">amp_high</span> <span class="o">=</span> <span class="n">psd_amp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fcurr</span> <span class="o">&gt;</span> <span class="n">f_high</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">new_psd_f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fcurr</span><span class="p">)</span>
            <span class="n">gradient</span> <span class="o">=</span> <span class="p">(</span><span class="n">amp_high</span> <span class="o">-</span> <span class="n">amp_low</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_high</span> <span class="o">-</span> <span class="n">f_low</span><span class="p">)</span>
            <span class="n">fDiff</span> <span class="o">=</span> <span class="n">fcurr</span> <span class="o">-</span> <span class="n">f_low</span>
            <span class="n">new_psd_amp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">amp_low</span> <span class="o">+</span> <span class="n">fDiff</span> <span class="o">*</span> <span class="n">gradient</span><span class="p">)</span>
            <span class="n">fcurr</span> <span class="o">=</span> <span class="n">fcurr</span> <span class="o">+</span> <span class="n">deltaF</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_psd_f</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_psd_amp</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="calculate_moment"><a class="viewcode-back" href="../../../pycbc.tmpltbank.html#pycbc.tmpltbank.calc_moments.calculate_moment">[docs]</a><span class="k">def</span> <span class="nf">calculate_moment</span><span class="p">(</span><span class="n">psd_f</span><span class="p">,</span> <span class="n">psd_amp</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">funct</span><span class="p">,</span>
                     <span class="n">norm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">vary_fmax</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">vary_density</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for calculating one of the integrals used to construct a template</span>
<span class="sd">    bank placement metric. The integral calculated will be</span>

<span class="sd">    \int funct(x) * (psd_x)**(-7./3.) * delta_x / PSD(x)</span>
<span class="sd"> </span>
<span class="sd">    where x = f / f0. The lower frequency cutoff is given by fmin, see</span>
<span class="sd">    the parameters below for details on how the upper frequency cutoff is</span>
<span class="sd">    chosen</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    psd_f : numpy.array</span>
<span class="sd">       numpy array holding the set of evenly spaced frequencies used in the PSD</span>
<span class="sd">    psd_amp : numpy.array</span>
<span class="sd">       numpy array holding the PSD values corresponding to the psd_f</span>
<span class="sd">       frequencies</span>
<span class="sd">    fmin : float</span>
<span class="sd">        The lower frequency cutoff used in the calculation of the integrals</span>
<span class="sd">        used to obtain the metric.</span>
<span class="sd">    fmax : float</span>
<span class="sd">        The upper frequency cutoff used in the calculation of the integrals</span>
<span class="sd">        used to obtain the metric. This can be varied (see the vary_fmax</span>
<span class="sd">        option below).</span>
<span class="sd">    f0 : float</span>
<span class="sd">        This is an arbitrary scaling factor introduced to avoid the potential</span>
<span class="sd">        for numerical overflow when calculating this. Generally the default</span>
<span class="sd">        value (70) is safe here. **IMPORTANT, if you want to calculate the</span>
<span class="sd">        ethinca metric components later this MUST be set equal to f_low.**</span>
<span class="sd">    funct : Lambda function</span>
<span class="sd">        The function to use when computing the integral as described above.</span>
<span class="sd">    norm : Dictionary of floats</span>
<span class="sd">        If given then moment[f_cutoff] will be divided by norm[f_cutoff]</span>
<span class="sd">    vary_fmax : boolean, optional (default False)</span>
<span class="sd">        If set to False the metric and rotations are calculated once, for the</span>
<span class="sd">        full range of frequency [f_low,f_upper).</span>
<span class="sd">        If set to True the metric and rotations are calculated multiple times,</span>
<span class="sd">        for frequency ranges [f_low,f_low + i*vary_density), where i starts at </span>
<span class="sd">        1 and runs up until f_low + (i+1)*vary_density &gt; f_upper. </span>
<span class="sd">        Thus values greater than f_upper are *not* computed. </span>
<span class="sd">        The calculation for the full range [f_low,f_upper) is also done.</span>
<span class="sd">    vary_density : float, optional</span>
<span class="sd">        If vary_fmax is True, this will be used in computing the frequency</span>
<span class="sd">        ranges as described for vary_fmax.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    moment : Dictionary of floats</span>
<span class="sd">        moment[f_cutoff] will store the value of the moment at the frequency</span>
<span class="sd">        cutoff given by f_cutoff.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Must ensure deltaF in psd_f is constant</span>
    <span class="n">psd_x</span> <span class="o">=</span> <span class="n">psd_f</span> <span class="o">/</span> <span class="n">f0</span>
    <span class="n">deltax</span> <span class="o">=</span> <span class="n">psd_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">psd_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">psd_f</span> <span class="o">&gt;</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">psd_f</span> <span class="o">&lt;</span> <span class="n">fmax</span><span class="p">)</span>
    <span class="n">psdf_red</span> <span class="o">=</span> <span class="n">psd_f</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">comps_red</span> <span class="o">=</span> <span class="n">psd_x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">7.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">funct</span><span class="p">(</span><span class="n">psd_x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">deltax</span> <span class="o">/</span> \
                <span class="n">psd_amp</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">moment</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">moment</span><span class="p">[</span><span class="n">fmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">comps_red</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">moment</span><span class="p">[</span><span class="n">fmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">moment</span><span class="p">[</span><span class="n">fmax</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span><span class="p">[</span><span class="n">fmax</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">vary_fmax</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t_fmax</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fmin</span> <span class="o">+</span> <span class="n">vary_density</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">vary_density</span><span class="p">):</span>
            <span class="n">moment</span><span class="p">[</span><span class="n">t_fmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">comps_red</span><span class="p">[</span><span class="n">psdf_red</span> <span class="o">&lt;</span> <span class="n">t_fmax</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
                <span class="n">moment</span><span class="p">[</span><span class="n">t_fmax</span><span class="p">]</span> <span class="o">=</span> <span class="n">moment</span><span class="p">[</span><span class="n">t_fmax</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span><span class="p">[</span><span class="n">t_fmax</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">moment</span>
</div>
<div class="viewcode-block" id="calculate_metric"><a class="viewcode-back" href="../../../pycbc.tmpltbank.html#pycbc.tmpltbank.calc_moments.calculate_metric">[docs]</a><span class="k">def</span> <span class="nf">calculate_metric</span><span class="p">(</span><span class="n">Js</span><span class="p">,</span> <span class="n">logJs</span><span class="p">,</span> <span class="n">loglogJs</span><span class="p">,</span> <span class="n">logloglogJs</span><span class="p">,</span> <span class="n">loglogloglogJs</span><span class="p">,</span> \
                     <span class="n">mapping</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will take the various integrals calculated by get_moments and</span>
<span class="sd">    convert this into a metric for the appropriate parameter space.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    Js : Dictionary</span>
<span class="sd">        The list of (log^0 x) * x**(-i/3) integrals computed by get_moments()</span>
<span class="sd">        The index is Js[i]</span>
<span class="sd">    logJs : Dictionary</span>
<span class="sd">        The list of (log^1 x) * x**(-i/3) integrals computed by get_moments()</span>
<span class="sd">        The index is logJs[i]</span>
<span class="sd">    loglogJs : Dictionary</span>
<span class="sd">        The list of (log^2 x) * x**(-i/3) integrals computed by get_moments()</span>
<span class="sd">        The index is loglogJs[i]</span>
<span class="sd">    logloglogJs : Dictionary</span>
<span class="sd">        The list of (log^3 x) * x**(-i/3) integrals computed by get_moments()</span>
<span class="sd">        The index is logloglogJs[i]</span>
<span class="sd">    loglogloglogJs : Dictionary</span>
<span class="sd">        The list of (log^4 x) * x**(-i/3) integrals computed by get_moments()</span>
<span class="sd">        The index is loglogloglogJs[i]</span>
<span class="sd">    mapping : dictionary</span>
<span class="sd">        Used to identify which Lambda components are active in this parameter</span>
<span class="sd">        space and map these to entries in the metric matrix.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    metric : numpy.matrix</span>
<span class="sd">        The resulting metric.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># How many dimensions in the parameter space?</span>
    <span class="n">maxLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">metric</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">maxLen</span><span class="p">,</span><span class="n">maxLen</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
    <span class="n">unmax_metric</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">maxLen</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">maxLen</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                  <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
            <span class="n">calculate_metric_comp</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">unmax_metric</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">Js</span><span class="p">,</span>
                                           <span class="n">logJs</span><span class="p">,</span> <span class="n">loglogJs</span><span class="p">,</span> <span class="n">logloglogJs</span><span class="p">,</span>
                                           <span class="n">loglogloglogJs</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metric</span><span class="p">,</span> <span class="n">unmax_metric</span>

</div>
<div class="viewcode-block" id="calculate_metric_comp"><a class="viewcode-back" href="../../../pycbc.tmpltbank.html#pycbc.tmpltbank.calc_moments.calculate_metric_comp">[docs]</a><span class="k">def</span> <span class="nf">calculate_metric_comp</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">unmax_metric</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">Js</span><span class="p">,</span> <span class="n">logJs</span><span class="p">,</span> <span class="n">loglogJs</span><span class="p">,</span>
                          <span class="n">logloglogJs</span><span class="p">,</span> <span class="n">loglogloglogJs</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to compute part of the metric. Only call this from within</span>
<span class="sd">    calculate_metric(). Please see the documentation for that function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Time term in unmax_metric. Note that these terms are recomputed a bunch</span>
    <span class="c"># of time, but this cost is insignificant compared to computing the moments</span>
    <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

    <span class="c"># Normal terms</span>
    <span class="k">if</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">):</span>
        <span class="n">gammaij</span> <span class="o">=</span> <span class="n">Js</span><span class="p">[</span><span class="mi">17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span>
        <span class="n">gamma0i</span> <span class="o">=</span> <span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">gamma0j</span> <span class="o">=</span> <span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">])</span>
        <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gammaij</span> <span class="o">-</span> <span class="n">gamma0i</span><span class="o">*</span><span class="n">gamma0j</span><span class="o">/</span><span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gammaij</span>
    <span class="c"># Normal,log cross terms</span>
    <span class="k">if</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">):</span>
        <span class="n">gammaij</span> <span class="o">=</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gamma0i</span> <span class="o">=</span> <span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">gamma0j</span> <span class="o">=</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gammaij</span> <span class="o">-</span> <span class="n">gamma0i</span><span class="o">*</span><span class="n">gamma0j</span><span class="o">/</span><span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gammaij</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gammaij</span>
    <span class="c"># Log,log terms</span>
    <span class="k">if</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">):</span>
        <span class="n">gammaij</span> <span class="o">=</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gamma0i</span> <span class="o">=</span> <span class="p">(</span><span class="n">logJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">gamma0j</span> <span class="o">=</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gammaij</span> <span class="o">-</span> <span class="n">gamma0i</span><span class="o">*</span><span class="n">gamma0j</span><span class="o">/</span><span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span>\
            <span class="n">gammaij</span>

    <span class="c"># Normal,loglog cross terms</span>
    <span class="k">if</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">):</span>
        <span class="n">gammaij</span> <span class="o">=</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gamma0i</span> <span class="o">=</span> <span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">gamma0j</span> <span class="o">=</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gammaij</span> <span class="o">-</span> <span class="n">gamma0i</span><span class="o">*</span><span class="n">gamma0j</span><span class="o">/</span><span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gammaij</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;Lambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gammaij</span>

    <span class="c"># log,loglog cross terms</span>
    <span class="k">if</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">):</span>
        <span class="n">gammaij</span> <span class="o">=</span> <span class="n">logloglogJs</span><span class="p">[</span><span class="mi">17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gamma0i</span> <span class="o">=</span> <span class="p">(</span><span class="n">logJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">logJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">gamma0j</span> <span class="o">=</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gammaij</span> <span class="o">-</span> <span class="n">gamma0i</span><span class="o">*</span><span class="n">gamma0j</span><span class="o">/</span><span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gammaij</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="n">gammaij</span>

    <span class="c"># Loglog,loglog terms</span>
    <span class="k">if</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">):</span>
        <span class="n">gammaij</span> <span class="o">=</span> <span class="n">loglogloglogJs</span><span class="p">[</span><span class="mi">17</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gamma0i</span> <span class="o">=</span> <span class="p">(</span><span class="n">loglogJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">i</span><span class="p">])</span>
        <span class="n">gamma0j</span> <span class="o">=</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">loglogJs</span><span class="p">[</span><span class="mi">12</span><span class="o">-</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gs</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gammaij</span> <span class="o">-</span> <span class="n">gamma0i</span><span class="o">*</span><span class="n">gamma0j</span><span class="o">/</span><span class="p">(</span><span class="n">Js</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Js</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma0i</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gamma0j</span>
        <span class="n">unmax_metric</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">],</span><span class="n">mapping</span><span class="p">[</span><span class="s">&#39;LogLogLambda</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span>\
            <span class="n">gammaij</span>
</pre></div></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Alexander Nitz.
      Last updated on Sep 08, 2015.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>